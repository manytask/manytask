version: "3.8"


volumes:
    cache:
    solutions:


services:
    nginx-proxy:
        image: nginxproxy/nginx-proxy:1.0.1
        container_name: nginx-proxy
        restart: always
        ports:
            - "80:80"
            - "433:433"
        volumes:
            - /var/run/docker.sock:/tmp/docker.sock:ro

    manytask:
        image: manytask/manytask:latest  # set SPECIFIC version you'll use
        container_name: manytask
        restart: always
        expose:
            - "5050"
        env_file: .env
        environment:
            VIRTUAL_HOST: py.manytask.org
            VIRTUAL_PORT: 5050
            VIRTUAL_PROTO: https
        healthcheck:
            test: [ "CMD", "curl", "-f", "http://localhost:5050/healthcheck" ]
            interval: 1m
            timeout: 15s
            retries: 3
            start_period: 30s
        volumes:
            - cache:/cache
            - solutions:/solutions
